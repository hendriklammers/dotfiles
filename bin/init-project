#!/bin/bash

# Check if yarn is installed, otherwise exit
command -v yarn >/dev/null 2>&1 ||
  { echo >&2 "Please make sure yarn package manager is installed. Aborting."; exit 1; }

# Ask for project title and description
if [ ! -z "$1" ]; then title=$1;
else read -p "Project title: " title; fi
if [ ! -z "$2" ]; then description="$2";
else read -p "Project description: " description; fi

# Validate title
titlePattern="^[a-zA-Z0-9-]{3,}$"
if [[ ! $title =~ $titlePattern ]]; then
  echo "Invalid project title. Aborting."; exit 1
fi

# Create new directory
if [ -d $title ]; then
  echo "Directory with this title already exists. Aborting"; exit 1
else
  mkdir -p "$title"
  cd "$title"
fi

# Clone project boilerplate
git clone git@github.com:hendriklammers/init-project.git .

# Add title and description to package.json and index.html
sed -i"" "s/PROJECT_TITLE/$title/g; s/PROJECT_DESCRIPTION/$description/g;"\
  package.json \
  public/index.html \
  README.md

# Install dev dependencies with yarn
yarn add -D \
  webpack \
  webpack-dev-server \
  eslint \
  babel-core \
  babel-loader \
  babel-polyfill \
  babel-preset-es2015 \
  babel-preset-stage-0 \
  css-loader \
  style-loader

# Remove .git directory, we want to start with a clean repo
if [ -d ".git" ]; then
  rm -rf .git
fi

# TODO: Add option to also create a new repo on Github
# Initialize new git repo and add everything
git init && git add . && git commit -m "Initial commit ðŸš€"
